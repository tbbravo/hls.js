!function(t,e,i){var n=function(){this.init=function(){var t={};this.on=function(e,i){t[e]||(t[e]=[]),t[e].push(i)},this.off=function(e,i){var n;return t[e]?(n=t[e].indexOf(i),t[e].splice(n,1),n>-1):!1},this.trigger=function(e){var i,n,a,s;if(i=t[e])if(2===arguments.length)for(a=i.length,n=0;a>n;++n)i[n].call(this,arguments[1]);else{for(s=[],n=arguments.length,n=1;n<arguments.length;++n)s.push(arguments[n]);for(a=i.length,n=0;a>n;++n)i[n].apply(this,s)}},this.dispose=function(){t={}}}};n.prototype.pipe=function(t){return this.on("data",function(e){t.push(e)}),this.on("done",function(){t.flush()}),t},n.prototype.push=function(t){this.trigger("data",t)},n.prototype.flush=function(){this.trigger("done")},t.muxjs=t.muxjs||{},t.muxjs.utils=t.muxjs.utils||{},t.muxjs.utils.Stream=n}(this,this.muxjs),function(t,e){var i;i=function(t){var e=t.byteLength,i=0,n=0;this.length=function(){return 8*e},this.bitsAvailable=function(){return 8*e+n},this.loadWord=function(){var a=t.byteLength-e,s=new Uint8Array(4),r=Math.min(4,e);if(0===r)throw new Error("no bytes available");s.set(t.subarray(a,a+r)),i=new DataView(s.buffer).getUint32(0),n=8*r,e-=r},this.skipBits=function(t){var a;n>t?(i<<=t,n-=t):(t-=n,a=Math.floor(t/8),t-=8*a,e-=a,this.loadWord(),i<<=t,n-=t)},this.readBits=function(t){var a=Math.min(n,t),s=i>>>32-a;return console.assert(32>t,"Cannot read more than 32 bits at a time"),n-=a,n>0?i<<=a:e>0&&this.loadWord(),a=t-a,a>0?s<<a|this.readBits(a):s},this.skipLeadingZeros=function(){var t;for(t=0;n>t;++t)if(0!==(i&2147483648>>>t))return i<<=t,n-=t,t;return this.loadWord(),t+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var t=this.skipLeadingZeros();return this.readBits(t+1)-1},this.readExpGolomb=function(){var t=this.readUnsignedExpGolomb();return 1&t?1+t>>>1:-1*(t>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()},t.muxjs=e||{},e.utils=e.utils||{},e.utils.ExpGolomb=i}(this,this.muxjs),function(t,e){"use strict";var i,n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=function(){var t,e;i.prototype.init.call(this),t=this,this.push=function(t){var i,a,s,r,o,h,p=0,d=0;if("audio"===t.type)for(e?(r=e,e=new Uint8Array(r.byteLength+t.data.byteLength),e.set(r),e.set(t.data,r.byteLength)):e=t.data;p+5<e.length;)if(255===e[p]&&240===(246&e[p+1])){if(a=2*(1&~e[p+1]),i=(3&e[p+3])<<11|e[p+4]<<3|(224&e[p+5])>>5,o=1024*((3&e[p+6])+1),h=9e4*o/n[(60&e[p+2])>>>2],s=p+i,e.byteLength<s)return;if(this.trigger("data",{pts:t.pts+d*h,dts:t.dts+d*h,sampleCount:o,audioobjecttype:(e[p+2]>>>6&3)+1,channelcount:(1&e[p+2])<<3|(192&e[p+3])>>>6,samplerate:n[(60&e[p+2])>>>2],samplingfrequencyindex:(60&e[p+2])>>>2,samplesize:16,data:e.subarray(p+7+a,s)}),e.byteLength===s)return void(e=void 0);d++,e=e.subarray(s)}else p++}},i.prototype=new e.utils.Stream,e.codecs=e.codecs||{},e.codecs.AacStream=i}(this,this.muxjs),function(t,e){"use strict";var i,n;n=function(){var t,e,i=0;n.prototype.init.call(this),this.push=function(n){var a;for(e?(a=new Uint8Array(e.byteLength+n.data.byteLength),a.set(e),a.set(n.data,e.byteLength),e=a):e=n.data;i<e.byteLength-3;i++)if(1===e[i+2]){t=i+5;break}for(;t<e.byteLength;)switch(e[t]){case 0:if(0!==e[t-1]){t+=2;break}if(0!==e[t-2]){t++;break}this.trigger("data",e.subarray(i+3,t-2));do t++;while(1!==e[t]&&t<e.length);i=t-2,t+=3;break;case 1:if(0!==e[t-1]||0!==e[t-2]){t+=3;break}this.trigger("data",e.subarray(i+3,t-2)),i=t-2,t+=3;break;default:t+=3}e=e.subarray(i),t-=i,i=0},this.flush=function(){e&&e.byteLength>3&&this.trigger("data",e.subarray(i+3)),e=null,i=0,this.trigger("done")}},n.prototype=new e.utils.Stream,i=function(){var t,a,s,r,o,h,p,d=new n;i.prototype.init.call(this),t=this,this.push=function(t){"video"===t.type&&(a=t.trackId,s=t.pts,r=t.dts,d.push(t))},d.on("data",function(e){var i={trackId:a,pts:s,dts:r,data:e};switch(31&e[0]){case 5:i.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:i.nalUnitType="sei_rbsp";break;case 7:i.nalUnitType="seq_parameter_set_rbsp",i.escapedRBSP=o(e.subarray(1)),i.config=h(i.escapedRBSP);break;case 8:i.nalUnitType="pic_parameter_set_rbsp";break;case 9:i.nalUnitType="access_unit_delimiter_rbsp"}t.trigger("data",i)}),d.on("done",function(){t.trigger("done")}),this.flush=function(){d.flush()},p=function(t,e){var i,n,a=8,s=8;for(i=0;t>i;i++)0!==s&&(n=e.readExpGolomb(),s=(a+n+256)%256),a=0===s?a:s},o=function(t){for(var e,i,n=t.byteLength,a=[],s=1;n-2>s;)0===t[s]&&0===t[s+1]&&3===t[s+2]?(a.push(s+2),s+=2):s++;if(0===a.length)return t;e=n-a.length,i=new Uint8Array(e);var r=0;for(s=0;e>s;r++,s++)r===a[0]&&(r++,a.shift()),i[s]=t[r];return i},h=function(t){var i,n,a,s,r,o,h,d,u,f,l,c,g=0,m=0,y=0,b=0;if(i=new e.utils.ExpGolomb(t),n=i.readUnsignedByte(),s=i.readUnsignedByte(),a=i.readUnsignedByte(),i.skipUnsignedExpGolomb(),(100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||139===n||134===n)&&(r=i.readUnsignedExpGolomb(),3===r&&i.skipBits(1),i.skipUnsignedExpGolomb(),i.skipUnsignedExpGolomb(),i.skipBits(1),i.readBoolean()))for(l=3!==r?8:12,c=0;l>c;c++)i.readBoolean()&&(6>c?p(16,i):p(64,i));if(i.skipUnsignedExpGolomb(),o=i.readUnsignedExpGolomb(),0===o)i.readUnsignedExpGolomb();else if(1===o)for(i.skipBits(1),i.skipExpGolomb(),i.skipExpGolomb(),h=i.readUnsignedExpGolomb(),c=0;h>c;c++)i.skipExpGolomb();return i.skipUnsignedExpGolomb(),i.skipBits(1),d=i.readUnsignedExpGolomb(),u=i.readUnsignedExpGolomb(),f=i.readBits(1),0===f&&i.skipBits(1),i.skipBits(1),i.readBoolean()&&(g=i.readUnsignedExpGolomb(),m=i.readUnsignedExpGolomb(),y=i.readUnsignedExpGolomb(),b=i.readUnsignedExpGolomb()),{profileIdc:n,levelIdc:a,profileCompatibility:s,width:16*(d+1)-2*g-2*m,height:(2-f)*(u+1)*16-2*y-2*b}}},i.prototype=new e.utils.Stream,e.codecs=e.codecs||{},e.codecs.H264Stream=i,e.codecs.NalByteStream=n}(this,this.muxjs),function(t,e){"use strict";var i;i=function(t,e){var n,a=0,s=16384,r=function(t,e){var i,n=t.position+e;n<t.bytes.byteLength||(i=new Uint8Array(2*n),i.set(t.bytes.subarray(0,t.position),0),t.bytes=i,t.view=new DataView(t.bytes.buffer))},o=i.widthBytes||new Uint8Array("width".length),h=i.heightBytes||new Uint8Array("height".length),p=i.videocodecidBytes||new Uint8Array("videocodecid".length);if(!i.widthBytes){for(n=0;n<"width".length;n++)o[n]="width".charCodeAt(n);for(n=0;n<"height".length;n++)h[n]="height".charCodeAt(n);for(n=0;n<"videocodecid".length;n++)p[n]="videocodecid".charCodeAt(n);i.widthBytes=o,i.heightBytes=h,i.videocodecidBytes=p}switch(this.keyFrame=!1,t){case i.VIDEO_TAG:this.length=16,s*=6;break;case i.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case i.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw"Error Unknown TagType"}this.bytes=new Uint8Array(s),this.view=new DataView(this.bytes.buffer),this.bytes[0]=t,this.position=this.length,this.keyFrame=e,this.pts=0,this.dts=0,this.writeBytes=function(t,e,i){var n,a=e||0;i=i||t.byteLength,n=a+i,r(this,i),this.bytes.set(t.subarray(a,n),this.position),this.position+=i,this.length=Math.max(this.length,this.position)},this.writeByte=function(t){r(this,1),this.bytes[this.position]=t,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(t){r(this,2),this.view.setUint16(this.position,t),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(t){return this.bytes[this.length-t]},this.nalUnitSize=function(){return 0===a?0:this.length-(a+4)},this.startNalUnit=function(){if(a>0)throw new Error("Attempted to create new NAL wihout closing the old one");a=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(t){var e,i;this.length===a+4?this.length-=4:a>0&&(e=a+4,i=this.length-e,this.position=a,this.view.setUint32(this.position,i),this.position=this.length,t&&t.push(this.bytes.subarray(e,e+i))),a=0},this.writeMetaDataDouble=function(t,e){var i;if(r(this,2+t.length+9),this.view.setUint16(this.position,t.length),this.position+=2,"width"===t)this.bytes.set(o,this.position),this.position+=5;else if("height"===t)this.bytes.set(h,this.position),this.position+=6;else if("videocodecid"===t)this.bytes.set(p,this.position),this.position+=12;else for(i=0;i<t.length;i++)this.bytes[this.position]=t.charCodeAt(i),this.position++;this.position++,this.view.setFloat64(this.position,e),this.position+=8,this.length=Math.max(this.length,this.position),++a},this.writeMetaDataBoolean=function(t,e){var i;for(r(this,2),this.view.setUint16(this.position,t.length),this.position+=2,i=0;i<t.length;i++)console.assert(t.charCodeAt(i)<255),r(this,1),this.bytes[this.position]=t.charCodeAt(i),this.position++;r(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,e?1:0),this.position++,this.length=Math.max(this.length,this.position),++a},this.finalize=function(){var t,n;switch(this.bytes[0]){case i.VIDEO_TAG:this.bytes[11]=7|(this.keyFrame||e?16:32),this.bytes[12]=e?0:1,t=this.pts-this.dts,this.bytes[13]=(16711680&t)>>>16,this.bytes[14]=(65280&t)>>>8,this.bytes[15]=(255&t)>>>0;break;case i.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=e?0:1;break;case i.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,a),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position}return n=this.length-11,this.bytes[1]=(16711680&n)>>>16,this.bytes[2]=(65280&n)>>>8,this.bytes[3]=(255&n)>>>0,this.bytes[4]=(16711680&this.dts)>>>16,this.bytes[5]=(65280&this.dts)>>>8,this.bytes[6]=(255&this.dts)>>>0,this.bytes[7]=(4278190080&this.dts)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,r(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=i.frameTime(this.bytes),console.assert(this.bytes.byteLength===this.length),this}},i.AUDIO_TAG=8,i.VIDEO_TAG=9,i.METADATA_TAG=18,i.isAudioFrame=function(t){return i.AUDIO_TAG===t[0]},i.isVideoFrame=function(t){return i.VIDEO_TAG===t[0]},i.isMetaData=function(t){return i.METADATA_TAG===t[0]},i.isKeyFrame=function(t){return i.isVideoFrame(t)?23===t[11]:i.isAudioFrame(t)?!0:i.isMetaData(t)?!0:!1},i.frameTime=function(t){var e=t[4]<<16;return e|=t[5]<<8,e|=t[6]<<0,e|=t[7]<<24},e.flv=e.flv||{},e.flv.FlvTag=i}(this,this.muxjs),function(t,e){"use strict";var i,n,a,s,r,o,h,p=e.flv.FlvTag;e.MetadataStream;r=function(t,e){"number"==typeof e.pts&&(void 0===t.timelineStartInfo.pts?t.timelineStartInfo.pts=e.pts:t.timelineStartInfo.pts=Math.min(t.timelineStartInfo.pts,e.pts)),"number"==typeof e.dts&&(void 0===t.timelineStartInfo.dts?t.timelineStartInfo.dts=e.dts:t.timelineStartInfo.dts=Math.min(t.timelineStartInfo.dts,e.dts))},o=function(t,e){var i=new p(p.METADATA_TAG);return i.dts=e,i.pts=e,i.writeMetaDataDouble("videocodecid",7),i.writeMetaDataDouble("width",t.width),i.writeMetaDataDouble("height",t.height),i},h=function(t,e){var i,n=new p(p.VIDEO_TAG,!0);for(n.dts=e,n.pts=e,n.writeByte(1),n.writeByte(t.profileIdc),n.writeByte(t.profileCompatibility),n.writeByte(t.levelIdc),n.writeByte(255),n.writeByte(225),n.writeShort(t.sps[0].length),n.writeBytes(t.sps[0]),n.writeByte(t.pps.length),i=0;i<t.pps.length;++i)n.writeShort(t.pps[i].length),n.writeBytes(t.pps[i]);return n},a=function(t){var e,i=[];a.prototype.init.call(this),this.push=function(e){r(t,e),t&&void 0===t.channelcount&&(t.audioobjecttype=e.audioobjecttype,t.channelcount=e.channelcount,t.samplerate=e.samplerate,t.samplingfrequencyindex=e.samplingfrequencyindex,t.samplesize=e.samplesize,t.extraData=t.audioobjecttype<<11|t.samplingfrequencyindex<<7|t.channelcount<<3),e.pts=Math.round(e.pts/90),e.dts=Math.round(e.dts/90),i.push(e)},this.flush=function(){var n,a,s,r=[];if(0===i.length)return void this.trigger("done");for(s=-(1/0);i.length;)n=i.shift(),(t.extraData!==e||n.pts-s>=1e3)&&(a=new p(p.METADATA_TAG),a.pts=n.pts,a.dts=n.dts,a.writeMetaDataDouble("audiocodecid",10),a.writeMetaDataBoolean("stereo",2===t.channelcount),a.writeMetaDataDouble("audiosamplerate",t.samplerate),a.writeMetaDataDouble("audiosamplesize",16),r.push(a),e=t.extraData,a=new p(p.AUDIO_TAG,!0),a.pts=n.pts,a.dts=n.dts,a.view.setUint16(a.position,t.extraData),a.position+=2,a.length=Math.max(a.length,a.position),r.push(a),s=n.pts),a=new p(p.AUDIO_TAG),a.pts=n.pts,a.dts=n.dts,a.writeBytes(n.data),r.push(a);e=null,this.trigger("data",{track:t,tags:r}),this.trigger("done")}},a.prototype=new e.utils.Stream,n=function(t){var e,i,a,s=[];n.prototype.init.call(this),this.finishFrame=function(i,n){n&&(t.newMetadata&&(n.keyFrame||0===i.length)&&(i.push(o(e,n.pts)),i.push(h(t,n.pts)),t.newMetadata=!1),n.endNalUnit(),i.push(n))},this.push=function(e){r(t,e),e.pts=Math.round(e.pts/90),e.dts=Math.round(e.dts/90),s.push(e)},this.flush=function(){var n,r=[];if(0===s.length)return void this.trigger("done");for(;s.length;)n=s.shift(),"seq_parameter_set_rbsp"===n.nalUnitType?(t.newMetadata=!0,e=n.config,t.width=e.width,t.height=e.height,t.sps=[n.data],t.profileIdc=e.profileIdc,t.levelIdc=e.levelIdc,t.profileCompatibility=e.profileCompatibility,a.endNalUnit()):"pic_parameter_set_rbsp"===n.nalUnitType?(t.newMetadata=!0,i=n.data,t.pps=[n.data],a.endNalUnit()):"access_unit_delimiter_rbsp"===n.nalUnitType?(a&&this.finishFrame(r,a),a=new p(p.VIDEO_TAG),a.pts=n.pts,a.dts=n.dts):("slice_layer_without_partitioning_rbsp_idr"===n.nalUnitType&&(a.keyFrame=!0),a.endNalUnit()),a.startNalUnit(),a.writeBytes(n.data);this.trigger("data",{track:t,tags:r}),this.trigger("done")}},n.prototype=new e.utils.Stream,s=function(t){this.numberOfTracks=0,this.metadataStream=t.metadataStream,this.videoTags=[],this.audioTags=[],this.videoTrack=null,this.audioTrack=null,this.pendingCaptions=[],this.pendingMetadata=[],this.pendingTracks=0,s.prototype.init.call(this),this.push=function(t){return t.text?this.pendingCaptions.push(t):t.frames?this.pendingMetadata.push(t):("video"===t.track.type&&(this.videoTrack=t.track,this.videoTags=t.tags,this.pendingTracks++),void("audio"===t.track.type&&(this.audioTrack=t.track,this.audioTags=t.tags,this.pendingTracks++)))}},s.prototype=new e.utils.Stream,s.prototype.flush=function(){var t,e,i,n,a={tags:{},captions:[],metadata:[]};if(!(this.pendingTracks<this.numberOfTracks)){for(this.videoTrack?n=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(n=this.audioTrack.timelineStartInfo.pts),a.tags.videoTags=this.videoTags,a.tags.audioTags=this.audioTags,i=0;i<this.pendingCaptions.length;i++)e=this.pendingCaptions[i],e.startTime=e.startPts-n,e.startTime/=9e4,e.endTime=e.endPts-n,e.endTime/=9e4,a.captions.push(e);for(i=0;i<this.pendingMetadata.length;i++)t=this.pendingMetadata[i],t.cueTime=t.pts-n,t.cueTime/=9e4,a.metadata.push(t);a.metadata.dispatchType=this.metadataStream.dispatchType,this.videoTrack=null,this.audioTrack=null,this.videoTags=[],this.audioTags=[],this.pendingCaptions.length=0,this.pendingMetadata.length=0,this.pendingTracks=0,this.trigger("data",a),this.trigger("done")}},i=function(t){var r,o,h,d,u,f,l,c,g,m=this;i.prototype.init.call(this),t=t||{},this.metadataStream=new e.mp2t.MetadataStream,t.metadataStream=this.metadataStream,r=new e.mp2t.TransportPacketStream,o=new e.mp2t.TransportParseStream,h=new e.mp2t.ElementaryStream,d=new e.codecs.AacStream,u=new e.codecs.H264Stream,g=new s(t),r.pipe(o).pipe(h),h.pipe(u),h.pipe(d),h.pipe(this.metadataStream).pipe(g),e.mp2t.CaptionStream&&(c=new e.mp2t.CaptionStream,u.pipe(c).pipe(g)),h.on("data",function(t){var e,i,s;if("metadata"===t.type){for(e=t.tracks.length;e--;)"video"===t.tracks[e].type?i=t.tracks[e]:"audio"===t.tracks[e].type&&(s=t.tracks[e]);i&&!f&&(g.numberOfTracks++,f=new n(i),u.pipe(f).pipe(g)),s&&!l&&(g.numberOfTracks++,l=new a(s),d.pipe(l).pipe(g))}}),this.push=function(t){r.push(t)},this.flush=function(){r.flush()},g.on("data",function(t){m.trigger("data",t)}),g.on("done",function(){m.trigger("done")}),this.getFlvHeader=function(t,e,i){var n,a,s,r=new Uint8Array(9),o=new DataView(r.buffer);return t=t||0,e=void 0===e?!0:e,i=void 0===i?!0:i,o.setUint8(0,70),o.setUint8(1,76),o.setUint8(2,86),o.setUint8(3,1),o.setUint8(4,(e?4:0)|(i?1:0)),o.setUint32(5,r.byteLength),0>=t?(a=new Uint8Array(r.byteLength+4),a.set(r),a.set([0,0,0,0],r.byteLength),a):(n=new p(p.METADATA_TAG),n.pts=n.dts=0,n.writeMetaDataDouble("duration",t),s=n.finalize().length,a=new Uint8Array(r.byteLength+s),a.set(r),a.set(o.byteLength,s),a)}},i.prototype=new e.utils.Stream,e.flv=e.flv||{},e.flv.Transmuxer=i}(this,this.muxjs),function(t,e,i){"use strict";var n=4,a=function(t){var e,i={payloadType:-1,payloadSize:0};if(t[1]!==n)return i;for(i.payloadType=n,e=2;e<t.length&&255===t[e];e++)i.payloadSize+=255;return i.payloadSize<<=8,i.payloadSize|=t[e],e++,i.payload=t.subarray(e,e+i.payloadSize),i},s=function(t){return 181!==t.payload[0]?null:49!==(t.payload[1]<<8|t.payload[2])?null:"GA94"!==String.fromCharCode(t.payload[3],t.payload[4],t.payload[5],t.payload[6])?null:3!==t.payload[7]?null:t.payload.subarray(8,t.payload.length-1)},r=function(t,e){var i,n,a,s,r=[];if(!(64&e[0]))return r;for(n=31&e[0],i=0;n>i;i++)a=3*i,s={type:3&e[a+2],pts:t},4&e[a+2]&&(s.ccData=e[a+3]<<8|e[a+4],r.push(s));return r},o=function(){o.prototype.init.call(this),this.field1_=new U,this.field1_.on("data",this.trigger.bind(this,"data"))};o.prototype=new e.utils.Stream,o.prototype.push=function(t){var e,i,o,h;if("sei_rbsp"===t.nalUnitType&&(e=a(t.data),e.payloadType===n&&(i=s(e))))for(o=r(t.pts,i),h=0;h<o.length;h++)0===o[h].type&&this.field1_.push(o[h])};var h={92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,42:225,127:9608},p=0,d=5152,u=5167,f=5157,l=5158,c=5159,g=5165,m=5153,y=5164,b=5166,v=14,w=function(){for(var t=[],e=v+1;e--;)t.push("");return t},U=function(){U.prototype.init.call(this),this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=w(),this.nonDisplayed_=w(),this.push=function(t){var e,i,n;switch(e=32639&t.ccData){case p:break;case d:this.mode_="popOn";break;case u:this.flushDisplayed(t.pts),i=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=i,this.startPts_=t.pts;break;case f:this.topRow_=v-1,this.mode_="rollUp";break;case l:this.topRow_=v-2,this.mode_="rollUp";break;case c:this.topRow_=v-3,this.mode_="rollUp";break;case g:this.flushDisplayed(t.pts),this.shiftRowsUp_(),this.startPts_=t.pts;break;case m:"popOn"===this.mode_?this.nonDisplayed_[v]=this.nonDisplayed_[v].slice(0,-1):this.displayed_[v]=this.displayed_[v].slice(0,-1);break;case y:this.flushDisplayed(t.pts),this.displayed_=w();break;case b:this.nonDisplayed_=w();break;default:if(n=e>>>8,16===(240&n))return;this[this.mode_](t.pts,n,255&e)}}};U.prototype=new e.utils.Stream,U.prototype.flushDisplayed=function(t){var e,i;for(i=0;i<this.displayed_.length;i++)e=this.displayed_[i],e.length&&this.trigger("data",{startPts:this.startPts_,endPts:t,text:e})},U.prototype.popOn=function(t,e,i){var n=this.nonDisplayed_[v];e=h[e]||e,n+=String.fromCharCode(e),i=h[i]||i,n+=String.fromCharCode(i),this.nonDisplayed_[v]=n},U.prototype.rollUp=function(t,e,i){var n=this.displayed_[v];""===n&&(this.flushDisplayed(t),this.startPts_=t),e=h[e]||e,n+=String.fromCharCode(e),i=h[i]||i,n+=String.fromCharCode(i),this.displayed_[v]=n},U.prototype.shiftRowsUp_=function(){var t;for(t=0;t<this.topRow_;t++)this.displayed_[t]="";for(t=this.topRow_;v>t;t++)this.displayed_[t]=this.displayed_[t+1];this.displayed_[v]=""},e.mp2t=e.mp2t||{},e.mp2t.CaptionStream=o,e.mp2t.Cea608Stream=U}(this,this.muxjs),function(t,e,i){"use strict";var n,a,s,r,o,h,p,d;r=188,d=71,o=27,h=15,p=21,n=function(){var t=new Uint8Array(r),e=0;n.prototype.init.call(this),this.push=function(i){var n,a=0,s=r;for(e?(n=new Uint8Array(i.byteLength+e),n.set(t.subarray(0,e)),n.set(i,e),e=0):n=i;s<n.byteLength;)n[a]!==d||n[s]!==d?(a++,s++):(this.trigger("data",n.subarray(a,s)),a+=r,s+=r);a<n.byteLength&&(t.set(n.subarray(a),0),e=n.byteLength-a)},this.flush=function(){e===r&&t[0]===d&&(this.trigger("data",t),e=0),this.trigger("done")}},n.prototype=new e.utils.Stream,a=function(){var t,e,n,s;a.prototype.init.call(this),s=this,this.packetsWaitingForPmt=[],this.programMapTable=i,t=function(t,i){var a=0;i.payloadUnitStartIndicator&&(a+=t[a]+1),"pat"===i.type?e(t.subarray(a),i):n(t.subarray(a),i)},e=function(t,e){e.section_number=t[7],e.last_section_number=t[8],s.pmtPid=(31&t[10])<<8|t[11],e.pmtPid=s.pmtPid},n=function(t,e){var i,n,a,r;if(1&t[5]){for(s.programMapTable={},i=(15&t[1])<<8|t[2],n=3+i-4,a=(15&t[10])<<8|t[11],r=12+a;n>r;)s.programMapTable[(31&t[r+1])<<8|t[r+2]]=t[r],r+=((15&t[r+3])<<8|t[r+4])+5;for(e.programMapTable=s.programMapTable;s.packetsWaitingForPmt.length;)s.processPes_.apply(s,s.packetsWaitingForPmt.shift())}},this.push=function(e){var n={},a=4;n.payloadUnitStartIndicator=!!(64&e[1]),n.pid=31&e[1],n.pid<<=8,n.pid|=e[2],(48&e[3])>>>4>1&&(a+=e[a]+1),0===n.pid?(n.type="pat",t(e.subarray(a),n),this.trigger("data",n)):n.pid===this.pmtPid?(n.type="pmt",t(e.subarray(a),n),this.trigger("data",n)):this.programMapTable===i?this.packetsWaitingForPmt.push([e,a,n]):this.processPes_(e,a,n)},this.processPes_=function(t,e,i){i.streamType=this.programMapTable[i.pid],i.type="pes",i.data=t.subarray(e),this.trigger("data",i)}},a.prototype=new e.utils.Stream,a.STREAM_TYPES={h264:27,adts:15},s=function(){var t,e={data:[],size:0},i={data:[],size:0},n={data:[],size:0},a=function(t,e){var i;e.dataAlignmentIndicator=0!==(4&t[6]),i=t[7],192&i&&(e.pts=(14&t[9])<<28|(255&t[10])<<21|(254&t[11])<<13|(255&t[12])<<6|(254&t[13])>>>2,e.pts*=2,e.pts+=(2&t[13])>>>1,e.dts=e.pts,64&i&&(e.dts=(14&t[14])<<28|(255&t[15])<<21|(254&t[16])<<13|(255&t[17])<<6|(254&t[18])>>>2,e.dts*=2,e.dts+=(2&t[18])>>>1)),e.data=t.subarray(9+t[8])},r=function(e,i){var n,s=new Uint8Array(e.size),r={type:i},o=0;if(e.data.length){for(r.trackId=e.data[0].pid;e.data.length;)n=e.data.shift(),s.set(n.data,o),o+=n.data.byteLength;a(s,r),e.size=0,t.trigger("data",r)}};s.prototype.init.call(this),t=this,this.push=function(a){({pat:function(){},pes:function(){var t,s;switch(a.streamType){case o:t=e,s="video";break;case h:t=i,s="audio";break;case p:t=n,s="timed-metadata";break;default:return}a.payloadUnitStartIndicator&&r(t,s),t.data.push(a),t.size+=a.data.byteLength},pmt:function(){var e,i,n={type:"metadata",tracks:[]},s=a.programMapTable;for(e in s)s.hasOwnProperty(e)&&(i={timelineStartInfo:{}},i.id=+e,s[e]===o?(i.codec="avc",i.type="video"):s[e]===h&&(i.codec="adts",i.type="audio"),n.tracks.push(i));t.trigger("data",n)}})[a.type]()},this.flush=function(){r(e,"video"),r(i,"audio"),r(n,"timed-metadata"),this.trigger("done")}},s.prototype=new e.utils.Stream,e.mp2t=e.mp2t||{},e.mp2t.PAT_PID=0,e.mp2t.MP2T_PACKET_LENGTH=r,e.mp2t.H264_STREAM_TYPE=o,e.mp2t.ADTS_STREAM_TYPE=h,e.mp2t.METADATA_STREAM_TYPE=p,e.mp2t.TransportPacketStream=n,e.mp2t.TransportParseStream=a,e.mp2t.ElementaryStream=s}(this,this.muxjs),function(t,e,i){"use strict";var n,a=function(t,e,i){var n,a="";for(n=e;i>n;n++)a+="%"+("00"+t[n].toString(16)).slice(-2);return a},s=function(e,i,n){return t.decodeURIComponent(a(e,i,n))},r=function(e,i,n){return t.unescape(a(e,i,n))},o={TXXX:function(t){var e;if(3===t.data[0]){for(e=1;e<t.data.length;e++)if(0===t.data[e]){t.description=s(t.data,1,e),t.value=s(t.data,e+1,t.data.length-1);break}t.data=t.value}},WXXX:function(t){var e;if(3===t.data[0])for(e=1;e<t.data.length;e++)if(0===t.data[e]){t.description=s(t.data,1,e),t.url=s(t.data,e+1,t.data.length);break}},PRIV:function(t){var e;for(e=0;e<t.data.length;e++)if(0===t.data[e]){t.owner=r(t.data,0,e);break}t.privateData=t.data.subarray(e+1),t.data=t.privateData}};n=function(t){var i,a={debug:!(!t||!t.debug),descriptor:t&&t.descriptor},s=0,r=[],h=0;if(n.prototype.init.call(this),this.dispatchType=e.mp2t.METADATA_STREAM_TYPE.toString(16),a.descriptor)for(i=0;i<a.descriptor.length;i++)this.dispatchType+=("00"+a.descriptor[i].toString(16)).slice(-2);this.push=function(t){var e,i,n,p,d;if("timed-metadata"===t.type){if(0===r.length&&(t.data.length<10||t.data[0]!=="I".charCodeAt(0)||t.data[1]!=="D".charCodeAt(0)||t.data[2]!=="3".charCodeAt(0)))return void(a.debug&&console.log("Skipping unrecognized metadata packet"));if(r.push(t),h+=t.data.byteLength,1===r.length&&(s=t.data[6]<<21|t.data[7]<<14|t.data[8]<<7|t.data[9],s+=10),!(s>h)){for(e={data:new Uint8Array(s),frames:[],pts:r[0].pts,dts:r[0].dts},d=0;s>d;)e.data.set(r[0].data,d),d+=r[0].data.byteLength,h-=r[0].data.byteLength,r.shift();i=10,64&e.data[5]&&(i+=4,i+=e.data[10]<<24|e.data[11]<<16|e.data[12]<<8|e.data[13],s-=e.data[16]<<24|e.data[17]<<16|e.data[18]<<8|e.data[19]);do{if(n=e.data[i+4]<<24|e.data[i+5]<<16|e.data[i+6]<<8|e.data[i+7],1>n)return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.");p={id:String.fromCharCode(e.data[i],e.data[i+1],e.data[i+2],e.data[i+3]),data:e.data.subarray(i+10,i+n+10)},p.key=p.id,o[p.id]&&o[p.id](p),e.frames.push(p),i+=10,i+=n}while(s>i);this.trigger("data",e)}}}},n.prototype=new e.utils.Stream,e.mp2t=e.mp2t||{},e.mp2t.MetadataStream=n}(this,this.muxjs),function(t,e,i){"use strict";var n,a,s,r,o,h,p,d,u,f,l,c,g,m,y,b,v,w,U,T,k,S,A,_,D,x,L,C,I,M,O,B,P,E,z,G,j,R,F;R=t.Uint8Array,F=t.DataView,function(){var t;_={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]};for(t in _)_.hasOwnProperty(t)&&(_[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);D=new R(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),L=new R(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),x=new R([0,0,0,1]),C=new R([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),I=new R([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),M={video:C,audio:I},P=new R([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),B=new R([0,0,0,0,0,0,0,0]),E=new R([0,0,0,0,0,0,0,0]),z=E,G=new R([0,0,0,0,0,0,0,0,0,0,0,0]),j=E,O=new R([0,0,0,1,0,0,0,0,0,0,0,0])}(),n=function(t){var e,i,n,a=[],s=0;for(e=1;e<arguments.length;e++)a.push(arguments[e]);for(e=a.length;e--;)s+=a[e].byteLength;for(i=new R(s+8),n=new F(i.buffer,i.byteOffset,i.byteLength),n.setUint32(0,i.byteLength),i.set(t,4),e=0,s=8;e<a.length;e++)i.set(a[e],s),s+=a[e].byteLength;return i},a=function(){return n(_.dinf,n(_.dref,P))},s=function(t){return n(_.esds,new R([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,t.audioobjecttype<<3|t.samplingfrequencyindex>>>1,t.samplingfrequencyindex<<7|t.channelcount<<3,6,1,2]))},r=function(){return n(_.ftyp,D,x,D,L)},b=function(t){return n(_.hdlr,M[t])},o=function(t){return n(_.mdat,t)},y=function(t){var e=new R([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,t.duration>>>24&255,t.duration>>>16&255,t.duration>>>8&255,255&t.duration,85,196,0,0]);return t.samplerate&&(e[12]=t.samplerate>>>24&255,e[13]=t.samplerate>>>16&255,e[14]=t.samplerate>>>8&255,e[15]=255&t.samplerate),n(_.mdhd,e)},m=function(t){return n(_.mdia,y(t),b(t.type),p(t))},h=function(t){return n(_.mfhd,new R([0,0,0,0,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t]))},p=function(t){return n(_.minf,"video"===t.type?n(_.vmhd,O):n(_.smhd,B),a(),w(t))},d=function(t,e){for(var i=[],a=e.length;a--;)i[a]=k(e[a]);return n.apply(null,[_.moof,h(t)].concat(i))},u=function(t){for(var e=t.length,i=[];e--;)i[e]=c(t[e]);return n.apply(null,[_.moov,l(4294967295)].concat(i).concat(f(t)))},f=function(t){for(var e=t.length,i=[];e--;)i[e]=S(t[e]);return n.apply(null,[_.mvex].concat(i))},l=function(t){var e=new R([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return n(_.mvhd,e)},v=function(t){var e,i,a=t.samples||[],s=new R(4+a.length);for(i=0;i<a.length;i++)e=a[i].flags,s[i+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return n(_.sdtp,s)},w=function(t){return n(_.stbl,U(t),n(_.stts,j),n(_.stsc,z),n(_.stsz,G),n(_.stco,E))},function(){var t,e;U=function(i){return n(_.stsd,new R([0,0,0,0,0,0,0,1]),"video"===i.type?t(i):e(i))},t=function(t){var e,i=t.sps||[],a=t.pps||[],s=[],r=[];for(e=0;e<i.length;e++)s.push((65280&i[e].byteLength)>>>8),s.push(255&i[e].byteLength),s=s.concat(Array.prototype.slice.call(i[e]));for(e=0;e<a.length;e++)r.push((65280&a[e].byteLength)>>>8),r.push(255&a[e].byteLength),r=r.concat(Array.prototype.slice.call(a[e]));return n(_.avc1,new R([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&t.width)>>8,255&t.width,(65280&t.height)>>8,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),n(_.avcC,new R([1,t.profileIdc,t.profileCompatibility,t.levelIdc,255].concat([i.length]).concat(s).concat([a.length]).concat(r))),n(_.btrt,new R([0,28,156,128,0,45,198,192,0,45,198,192])))},e=function(t){return n(_.mp4a,new R([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&t.channelcount)>>8,255&t.channelcount,(65280&t.samplesize)>>8,255&t.samplesize,0,0,0,0,(65280&t.samplerate)>>8,255&t.samplerate,0,0]),s(t))}}(),T=function(){return n(_.styp,D,x,D)},g=function(t){var e=new R([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,0,(4278190080&t.duration)>>24,(16711680&t.duration)>>16,(65280&t.duration)>>8,255&t.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&t.width)>>8,255&t.width,0,0,(65280&t.height)>>8,255&t.height,0,0]);return n(_.tkhd,e)},k=function(t){var e,i,a,s,r;return e=n(_.tfhd,new R([0,0,0,58,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),i=n(_.tfdt,new R([0,0,0,0,t.baseMediaDecodeTime>>>24&255,t.baseMediaDecodeTime>>>16&255,t.baseMediaDecodeTime>>>8&255,255&t.baseMediaDecodeTime])),r=88,"audio"===t.type?(a=A(t,r),n(_.traf,e,i,a)):(s=v(t),a=A(t,s.length+r),n(_.traf,e,i,a,s))},c=function(t){return t.duration=t.duration||4294967295,n(_.trak,g(t),m(t))},S=function(t){var e=new R([0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==t.type&&(e[e.length-1]=0),n(_.trex,e)},function(){var t,e,a;a=function(t,e){var n=0,a=0,s=0,r=0;return t.length&&(t[0].duration!==i&&(n=1),t[0].size!==i&&(a=2),t[0].flags!==i&&(s=4),t[0].compositionTimeOffset!==i&&(r=8)),[0,0,n|a|s|r,1,(4278190080&t.length)>>>24,(16711680&t.length)>>>16,(65280&t.length)>>>8,255&t.length,(4278190080&e)>>>24,(16711680&e)>>>16,(65280&e)>>>8,255&e]},e=function(t,e){var i,s,r,o;for(s=t.samples||[],e+=20+16*s.length,i=a(s,e),o=0;o<s.length;o++)r=s[o],i=i.concat([(4278190080&r.duration)>>>24,(16711680&r.duration)>>>16,(65280&r.duration)>>>8,255&r.duration,(4278190080&r.size)>>>24,(16711680&r.size)>>>16,(65280&r.size)>>>8,255&r.size,r.flags.isLeading<<2|r.flags.dependsOn,r.flags.isDependedOn<<6|r.flags.hasRedundancy<<4|r.flags.paddingValue<<1|r.flags.isNonSyncSample,61440&r.flags.degradationPriority,15&r.flags.degradationPriority,(4278190080&r.compositionTimeOffset)>>>24,(16711680&r.compositionTimeOffset)>>>16,(65280&r.compositionTimeOffset)>>>8,255&r.compositionTimeOffset]);return n(_.trun,new R(i))},t=function(t,e){var i,s,r,o;for(s=t.samples||[],e+=20+8*s.length,i=a(s,e),o=0;o<s.length;o++)r=s[o],i=i.concat([(4278190080&r.duration)>>>24,(16711680&r.duration)>>>16,(65280&r.duration)>>>8,255&r.duration,(4278190080&r.size)>>>24,(16711680&r.size)>>>16,(65280&r.size)>>>8,255&r.size]);
return n(_.trun,new R(i))},A=function(i,n){return"audio"===i.type?t(i,n):e(i,n)}}(),e.mp4={ftyp:r,mdat:o,moof:d,moov:u,initSegment:function(t){var e,i=r(),n=u(t);return e=new R(i.byteLength+n.byteLength),e.set(i),e.set(n,i.byteLength),e}}}(this,this.muxjs),function(t,e,i){"use strict";var n,a,s,r,o,h,p,d=e.mp4;a=function(t){var e=[],n=0,s=0,r=0;a.prototype.init.call(this),this.push=function(a){o(t,a),t&&t.channelcount===i&&(t.audioobjecttype=a.audioobjecttype,t.channelcount=a.channelcount,t.samplerate=a.samplerate,t.samplingfrequencyindex=a.samplingfrequencyindex,t.samplesize=a.samplesize),e.push(a),n+=a.data.byteLength},this.setEarliestDts=function(t){r=t},this.flush=function(){var i,a,o,u,f,l,c;if(0===n)return void this.trigger("done");for(t.minSegmentDts<r&&(t.minSegmentDts=1/0,e=e.filter(function(e){return e.dts>=r?(t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),!0):(n-=e.data.byteLength,!1)})),o=new Uint8Array(n),t.samples=[],f=0;e.length;)a=e[0],u={size:a.data.byteLength,duration:1024},t.samples.push(u),o.set(a.data,f),f+=a.data.byteLength,e.shift();n=0,l=d.mdat(o),p(t),c=d.moof(s,[t]),i=new Uint8Array(c.byteLength+l.byteLength),s++,i.set(c),i.set(l,c.byteLength),h(t),this.trigger("data",{track:t,boxes:i}),this.trigger("done")}},a.prototype=new e.utils.Stream,n=function(t){var e,a,s=0,r=[],u=0;n.prototype.init.call(this),delete t.minPTS,this.push=function(i){o(t,i),"seq_parameter_set_rbsp"!==i.nalUnitType||e||(e=i.config,t.width=e.width,t.height=e.height,t.sps=[i.data],t.profileIdc=e.profileIdc,t.levelIdc=e.levelIdc,t.profileCompatibility=e.profileCompatibility),"pic_parameter_set_rbsp"!==i.nalUnitType||a||(a=i.data,t.pps=[i.data]),r.push(i),u+=i.data.byteLength},this.flush=function(){var n,o,f,l,c,g,m,y,b;if(0===u)return void this.trigger("done");for(m=new Uint8Array(u+4*r.length),y=new DataView(m.buffer),t.samples=[],b={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0}},g=0;r.length;)o=r[0],"access_unit_delimiter_rbsp"===o.nalUnitType&&(n&&(b.duration=o.dts-n.dts,t.samples.push(b)),b={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0},compositionTimeOffset:o.pts-o.dts},n=o),"slice_layer_without_partitioning_rbsp_idr"===o.nalUnitType&&(b.flags.dependsOn=2),b.size+=4,b.size+=o.data.byteLength,y.setUint32(g,o.data.byteLength),g+=4,m.set(o.data,g),g+=o.data.byteLength,r.shift();t.samples.length&&(b.duration=t.samples[t.samples.length-1].duration),t.samples.push(b),u=0,l=d.mdat(m),p(t),this.trigger("timelineStartInfo",t.timelineStartInfo),f=d.moof(s,[t]),c=new Uint8Array(f.byteLength+l.byteLength),s++,c.set(f),c.set(l,f.byteLength),h(t),this.trigger("data",{track:t,boxes:c}),e=i,a=i,this.trigger("done")}},n.prototype=new e.utils.Stream,o=function(t,e){"number"==typeof e.pts&&(t.timelineStartInfo.pts===i?t.timelineStartInfo.pts=e.pts:t.timelineStartInfo.pts=Math.min(t.timelineStartInfo.pts,e.pts)),"number"==typeof e.dts&&(t.timelineStartInfo.dts===i?t.timelineStartInfo.dts=e.dts:t.timelineStartInfo.dts=Math.min(t.timelineStartInfo.dts,e.dts),t.minSegmentDts===i?t.minSegmentDts=e.dts:t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),t.maxSegmentDts===i?t.maxSegmentDts=e.dts:t.maxSegmentDts=Math.max(t.maxSegmentDts,e.dts))},h=function(t){delete t.minSegmentDts,delete t.maxSegmentDts},p=function(t){var e,i=9e4;t.baseMediaDecodeTime=t.minSegmentDts-t.timelineStartInfo.dts,"audio"===t.type&&(e=t.samplerate/i,t.baseMediaDecodeTime*=e,t.baseMediaDecodeTime=Math.floor(t.baseMediaDecodeTime))},r=function(t){this.numberOfTracks=0,this.metadataStream=t.metadataStream,"undefined"!=typeof t.remux?this.remuxTracks=!!t.remux:this.remuxTracks=!0,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,r.prototype.init.call(this),this.push=function(t){return t.text?this.pendingCaptions.push(t):t.frames?this.pendingMetadata.push(t):(this.pendingTracks.push(t.track),this.pendingBoxes.push(t.boxes),this.pendingBytes+=t.boxes.byteLength,"video"===t.track.type&&(this.videoTrack=t.track),void("audio"===t.track.type&&(this.audioTrack=t.track)))}},r.prototype=new e.utils.Stream,r.prototype.flush=function(){var t,i,n,a,s=0,r={captions:[],metadata:[]},o=0;if(!(0===this.pendingTracks.length||this.remuxTracks&&this.pendingTracks.length<this.numberOfTracks)){for(this.videoTrack?o=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(o=this.audioTrack.timelineStartInfo.pts),1===this.pendingTracks.length?r.type=this.pendingTracks[0].type:r.type="combined",n=e.mp4.initSegment(this.pendingTracks),r.data=new Uint8Array(n.byteLength+this.pendingBytes),r.data.set(n),s+=n.byteLength,a=0;a<this.pendingBoxes.length;a++)r.data.set(this.pendingBoxes[a],s),s+=this.pendingBoxes[a].byteLength;for(a=0;a<this.pendingCaptions.length;a++)t=this.pendingCaptions[a],t.startTime=t.startPts-o,t.startTime/=9e4,t.endTime=t.endPts-o,t.endTime/=9e4,r.captions.push(t);for(a=0;a<this.pendingMetadata.length;a++)i=this.pendingMetadata[a],i.cueTime=i.pts-o,i.cueTime/=9e4,r.metadata.push(i);r.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",r),this.trigger("done")}},s=function(t){var i,o,h,p,d,u,f,l,c,g=this;s.prototype.init.call(this),t=t||{},this.metadataStream=new e.mp2t.MetadataStream,t.metadataStream=this.metadataStream,i=new e.mp2t.TransportPacketStream,o=new e.mp2t.TransportParseStream,h=new e.mp2t.ElementaryStream,p=new e.codecs.AacStream,d=new e.codecs.H264Stream,c=new r(t),i.pipe(o).pipe(h),h.pipe(d),h.pipe(p),h.pipe(this.metadataStream).pipe(c),e.mp2t.CaptionStream&&(l=new e.mp2t.CaptionStream,d.pipe(l).pipe(c)),h.on("data",function(t){var e,i,s;if("metadata"===t.type){for(e=t.tracks.length;e--;)"video"===t.tracks[e].type?i=t.tracks[e]:"audio"===t.tracks[e].type&&(s=t.tracks[e]);i&&!u&&(c.numberOfTracks++,u=new n(i),u.on("timelineStartInfo",function(t){s&&(s.timelineStartInfo=t,f.setEarliestDts(t.dts))}),d.pipe(u).pipe(c)),s&&!f&&(c.numberOfTracks++,f=new a(s),p.pipe(f).pipe(c))}}),this.push=function(t){i.push(t)},this.flush=function(){i.flush()},c.on("data",function(t){g.trigger("data",t)}),c.on("done",function(){g.trigger("done")})},s.prototype=new e.utils.Stream,e.mp4=e.mp4||{},e.mp4.VideoSegmentStream=n,e.mp4.Transmuxer=s}(this,this.muxjs),function(t,e){var n=function(t){return"0x"+("00"+t.toString(16)).slice(-2).toUpperCase()},a=function(t){for(var e=[];t.byteLength>0;){switch(i=0,t.byteLength){default:e.push(n(t[i++]));case 7:e.push(n(t[i++]));case 6:e.push(n(t[i++]));case 5:e.push(n(t[i++]));case 4:e.push(n(t[i++]));case 3:e.push(n(t[i++]));case 2:e.push(n(t[i++]));case 1:e.push(n(t[i++]))}t=t.subarray(i)}return e.join(" ")},s=function(t,e){var i=["AVC Sequence Header","AVC NALU","AVC End-of-Sequence"],n=t[1]&parseInt("01111111",2)<<16|t[2]<<8|t[3];return e=e||{},e.avcPacketType=i[t[0]],e.CompositionTime=t[1]&parseInt("10000000",2)?-n:n,1===t[0]?e.nalUnitTypeRaw=a(t.subarray(4,100)):e.data=a(t.subarray(4)),e},r=function(t,e){var i=["Unknown","Keyframe (for AVC, a seekable frame)","Inter frame (for AVC, a nonseekable frame)","Disposable inter frame (H.263 only)","Generated keyframe (reserved for server use only)","Video info/command frame"],n=t[0]&parseInt("00001111",2);return e=e||{},e.frameType=i[(t[0]&parseInt("11110000",2))>>>4],e.codecID=n,7===n?s(t.subarray(1),e):e},o=function(t,e){var i=["AAC Sequence Header","AAC Raw"];return e=e||{},e.aacPacketType=i[t[0]],e.data=a(t.subarray(1)),e},h=function(t,e){var i=["Linear PCM, platform endian","ADPCM","MP3","Linear PCM, little endian","Nellymoser 16-kHz mono","Nellymoser 8-kHz mono","Nellymoser","G.711 A-law logarithmic PCM","G.711 mu-law logarithmic PCM","reserved","AAC","Speex","MP3 8-Khz","Device-specific sound"],n=["5.5-kHz","11-kHz","22-kHz","44-kHz"],a=(t[0]&parseInt("11110000",2))>>>4;return e=e||{},e.soundFormat=i[a],e.soundRate=n[(t[0]&parseInt("00001100",2))>>>2],e.soundSize=(t[0]&parseInt("00000010",2))>>>1?"16-bit":"8-bit",e.soundType=t[0]&parseInt("00000001",2)?"Stereo":"Mono",10===a?o(t.subarray(1),e):e},p=function(t){return{tagType:tagTypes[t[0]],dataSize:t[1]<<16|t[2]<<8|t[3],timestamp:t[7]<<24|t[4]<<16|t[5]<<8|t[6],streamID:t[8]<<16|t[9]<<8|t[10]}},d=function(t){var e=p(t);switch(t[0]){case 8:h(t.subarray(11),e);break;case 9:r(t.subarray(11),e);break;case 18:}return e},u=function(t){var e,i,n=9,a=[];for(n+=4;n<t.byteLength;)e=t[n+1]<<16,e|=t[n+2]<<8,e|=t[n+3],e+=11,i=t.subarray(n,n+e),a.push(d(i)),n+=e+4;return a},f=function(t){return JSON.stringify(t,null,2)};t.muxjs=t.muxjs||{},e.tools=e.tools||{},e.tools.inspectFlvTag=d,e.tools.inspectFlv=u,e.tools.textifyFlv=f}(this,this.muxjs),function(t,e){"use strict";var i,n,a=t.DataView,s=function(t){var e="";return e+=String.fromCharCode(t[0]),e+=String.fromCharCode(t[1]),e+=String.fromCharCode(t[2]),e+=String.fromCharCode(t[3])},r=function(t){return new Date(1e3*t-20828448e5)},o=function(t){return{isLeading:(12&t[0])>>>2,dependsOn:3&t[0],isDependedOn:(192&t[1])>>>6,hasRedundancy:(48&t[1])>>>4,paddingValue:(14&t[1])>>>1,isNonSyncSample:1&t[1],degradationPriority:t[2]<<8|t[3]}},h=function(t){var e,i,n=new a(t.buffer,t.byteOffset,t.byteLength),s=[];for(e=0;e+4<t.length;e+=i){if(i=n.getUint32(e),e+=4,0>=i)return;switch(31&t[e]){case 1:s.push("slice_layer_without_partitioning_rbsp");break;case 5:s.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:s.push("sei_rbsp");break;case 7:s.push("seq_parameter_set_rbsp");break;case 8:s.push("pic_parameter_set_rbsp");break;case 9:s.push("access_unit_delimiter_rbsp");break;default:s.push(31&t[e])}}return s},p={avc1:function(t){var e=new a(t.buffer,t.byteOffset,t.byteLength);return{dataReferenceIndex:e.getUint16(6),width:e.getUint16(24),height:e.getUint16(26),horizresolution:e.getUint16(28)+e.getUint16(30)/16,vertresolution:e.getUint16(32)+e.getUint16(34)/16,frameCount:e.getUint16(40),depth:e.getUint16(74),config:i(t.subarray(78,t.byteLength))}},avcC:function(t){var e,i,n,s,r=new a(t.buffer,t.byteOffset,t.byteLength),o={configurationVersion:t[0],avcProfileIndication:t[1],profileCompatibility:t[2],avcLevelIndication:t[3],lengthSizeMinusOne:3&t[4],sps:[],pps:[]},h=31&t[5];for(n=6,s=0;h>s;s++)i=r.getUint16(n),n+=2,o.sps.push(new Uint8Array(t.subarray(n,n+i))),n+=i;for(e=t[n],n++,s=0;e>s;s++)i=r.getUint16(n),n+=2,o.pps.push(new Uint8Array(t.subarray(n,n+i))),n+=i;return o},btrt:function(t){var e=new a(t.buffer,t.byteOffset,t.byteLength);return{bufferSizeDB:e.getUint32(0),maxBitrate:e.getUint32(4),avgBitrate:e.getUint32(8)}},esds:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),esId:t[6]<<8|t[7],streamPriority:31&t[8],decoderConfig:{objectProfileIndication:t[11],streamType:t[12]>>>2&63,bufferSize:t[13]<<16|t[14]<<8|t[15],maxBitrate:t[16]<<24|t[17]<<16|t[18]<<8|t[19],avgBitrate:t[20]<<24|t[21]<<16|t[22]<<8|t[23],decoderConfigDescriptor:{tag:t[24],length:t[25],audioObjectType:t[26]>>>3&31,samplingFrequencyIndex:(7&t[26])<<1|t[27]>>>7&1,channelConfiguration:t[27]>>>3&15}}}},ftyp:function(t){for(var e=new a(t.buffer,t.byteOffset,t.byteLength),i={majorBrand:s(t.subarray(0,4)),minorVersion:e.getUint32(4),compatibleBrands:[]},n=8;n<t.byteLength;)i.compatibleBrands.push(s(t.subarray(n,n+4))),n+=4;return i},dinf:function(t){return{boxes:i(t)}},dref:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),dataReferences:i(t.subarray(8))}},hdlr:function(e){var i=new a(e.buffer,e.byteOffset,e.byteLength),n={version:i.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),handlerType:s(e.subarray(8,12)),name:""},r=8;for(r=24;r<e.byteLength;r++){if(0===e[r]){r++;break}n.name+=String.fromCharCode(e[r])}return n.name=t.decodeURIComponent(t.escape(n.name)),n},mdat:function(t){return{byteLength:t.byteLength,nals:h(t)}},mdhd:function(t){var e,i=new a(t.buffer,t.byteOffset,t.byteLength),n=4,s={version:i.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),language:""};return 1===s.version?(n+=4,s.creationTime=r(i.getUint32(n)),n+=8,s.modificationTime=r(i.getUint32(n)),n+=4,s.timescale=i.getUint32(n),n+=8,s.duration=i.getUint32(n)):(s.creationTime=r(i.getUint32(n)),n+=4,s.modificationTime=r(i.getUint32(n)),n+=4,s.timescale=i.getUint32(n),n+=4,s.duration=i.getUint32(n)),n+=4,e=i.getUint16(n),s.language+=String.fromCharCode((e>>10)+96),s.language+=String.fromCharCode(((960&e)>>5)+96),s.language+=String.fromCharCode((31&e)+96),s},mdia:function(t){return{boxes:i(t)}},mfhd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),sequenceNumber:t[4]<<24|t[5]<<16|t[6]<<8|t[7]}},minf:function(t){return{boxes:i(t)}},mp4a:function(t){var e=new a(t.buffer,t.byteOffset,t.byteLength),n={dataReferenceIndex:e.getUint16(6),channelcount:e.getUint16(16),samplesize:e.getUint16(18),samplerate:e.getUint16(24)+e.getUint16(26)/65536};return t.byteLength>28&&(n.streamDescriptor=i(t.subarray(28))[0]),n},moof:function(t){return{boxes:i(t)}},moov:function(t){return{boxes:i(t)}},mvex:function(t){return{boxes:i(t)}},mvhd:function(t){var e=new a(t.buffer,t.byteOffset,t.byteLength),i=4,n={version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4))};return 1===n.version?(i+=4,n.creationTime=r(e.getUint32(i)),i+=8,n.modificationTime=r(e.getUint32(i)),i+=4,n.timescale=e.getUint32(i),i+=8,n.duration=e.getUint32(i)):(n.creationTime=r(e.getUint32(i)),i+=4,n.modificationTime=r(e.getUint32(i)),i+=4,n.timescale=e.getUint32(i),i+=4,n.duration=e.getUint32(i)),i+=4,n.rate=e.getUint16(i)+e.getUint16(i+2)/16,i+=4,n.volume=e.getUint8(i)+e.getUint8(i+1)/8,i+=2,i+=2,i+=8,n.matrix=new Uint32Array(t.subarray(i,i+36)),i+=36,i+=24,n.nextTrackId=e.getUint32(i),n},pdin:function(t){var e=new a(t.buffer,t.byteOffset,t.byteLength);return{version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),rate:e.getUint32(4),initialDelay:e.getUint32(8)}},sdtp:function(t){var e,i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),samples:[]};for(e=4;e<t.byteLength;e++)i.samples.push({dependsOn:(48&t[e])>>4,isDependedOn:(12&t[e])>>2,hasRedundancy:3&t[e]});return i},sidx:function(t){var e,i=new a(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),references:[],referenceId:i.getUint32(4),timescale:i.getUint32(8),earliestPresentationTime:i.getUint32(12),firstOffset:i.getUint32(16)},s=i.getUint16(22);for(e=24;s;e+=12,s--)n.references.push({referenceType:(128&t[e])>>>7,referencedSize:2147483647&i.getUint32(e),subsegmentDuration:i.getUint32(e+4),startsWithSap:!!(128&t[e+8]),sapType:(112&t[e+8])>>>4,sapDeltaTime:268435455&i.getUint32(e+8)});return n},smhd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),balance:t[4]+t[5]/256}},stbl:function(t){return{boxes:i(t)}},stco:function(t){var e,i=new a(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),chunkOffsets:[]},s=i.getUint32(4);for(e=8;s;e+=4,s--)n.chunkOffsets.push(i.getUint32(e));return n},stsc:function(t){var e,i=new a(t.buffer,t.byteOffset,t.byteLength),n=i.getUint32(4),s={version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleToChunks:[]};for(e=8;n;e+=12,n--)s.sampleToChunks.push({firstChunk:i.getUint32(e),samplesPerChunk:i.getUint32(e+4),sampleDescriptionIndex:i.getUint32(e+8)});return s},stsd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleDescriptions:i(t.subarray(8))}},stsz:function(t){var e,i=new a(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleSize:i.getUint32(4),entries:[]};for(e=12;e<t.byteLength;e+=4)n.entries.push(i.getUint32(e));return n},stts:function(t){var e,i=new a(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),timeToSamples:[]},s=i.getUint32(4);for(e=8;s;e+=8,s--)n.timeToSamples.push({sampleCount:i.getUint32(e),sampleDelta:i.getUint32(e+4)});return n},styp:function(t){return p.ftyp(t)},tfdt:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),baseMediaDecodeTime:t[4]<<24|t[5]<<16|t[6]<<8|t[7]}},tfhd:function(t){var e,i=new a(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),trackId:i.getUint32(4)},s=1&n.flags[2],r=2&n.flags[2],o=8&n.flags[2],h=16&n.flags[2],p=32&n.flags[2];return e=8,s&&(e+=4,n.baseDataOffset=i.getUint32(12),e+=4),r&&(n.sampleDescriptionIndex=i.getUint32(e),e+=4),o&&(n.defaultSampleDuration=i.getUint32(e),e+=4),h&&(n.defaultSampleSize=i.getUint32(e),e+=4),p&&(n.defaultSampleFlags=i.getUint32(e)),n},tkhd:function(t){var e=new a(t.buffer,t.byteOffset,t.byteLength),i=4,n={version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4))};return 1===n.version?(i+=4,n.creationTime=r(e.getUint32(i)),i+=8,n.modificationTime=r(e.getUint32(i)),i+=4,n.trackId=e.getUint32(i),i+=4,i+=8,n.duration=e.getUint32(i)):(n.creationTime=r(e.getUint32(i)),i+=4,n.modificationTime=r(e.getUint32(i)),i+=4,n.trackId=e.getUint32(i),i+=4,i+=4,n.duration=e.getUint32(i)),i+=4,i+=8,n.layer=e.getUint16(i),i+=2,n.alternateGroup=e.getUint16(i),i+=2,n.volume=e.getUint8(i)+e.getUint8(i+1)/8,i+=2,i+=2,n.matrix=new Uint32Array(t.subarray(i,i+36)),i+=36,n.width=e.getUint16(i)+e.getUint16(i+2)/16,i+=4,n.height=e.getUint16(i)+e.getUint16(i+2)/16,n},traf:function(t){return{boxes:i(t)}},trak:function(t){return{boxes:i(t)}},trex:function(t){var e=new a(t.buffer,t.byteOffset,t.byteLength);return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),trackId:e.getUint32(4),defaultSampleDescriptionIndex:e.getUint32(8),defaultSampleDuration:e.getUint32(12),defaultSampleSize:e.getUint32(16),sampleDependsOn:3&t[20],sampleIsDependedOn:(192&t[21])>>6,sampleHasRedundancy:(48&t[21])>>4,samplePaddingValue:(14&t[21])>>1,sampleIsDifferenceSample:!!(1&t[21]),sampleDegradationPriority:e.getUint16(22)}},trun:function(t){var e,i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),samples:[]},n=new a(t.buffer,t.byteOffset,t.byteLength),s=1&i.flags[2],r=4&i.flags[2],h=1&i.flags[1],p=2&i.flags[1],d=4&i.flags[1],u=8&i.flags[1],f=n.getUint32(4),l=8;for(s&&(i.dataOffset=n.getUint32(l),l+=4),r&&f&&(e={flags:o(t.subarray(l,l+4))},l+=4,h&&(e.duration=n.getUint32(l),l+=4),p&&(e.size=n.getUint32(l),l+=4),u&&(e.compositionTimeOffset=n.getUint32(l),l+=4),i.samples.push(e),f--);f--;)e={},h&&(e.duration=n.getUint32(l),l+=4),p&&(e.size=n.getUint32(l),l+=4),d&&(e.flags=o(t.subarray(l,l+4)),l+=4),u&&(e.compositionTimeOffset=n.getUint32(l),l+=4),i.samples.push(e);return i},"url ":function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4))}},vmhd:function(t){var e=new a(t.buffer,t.byteOffset,t.byteLength);return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),graphicsmode:e.getUint16(4),opcolor:new Uint16Array([e.getUint16(6),e.getUint16(8),e.getUint16(10)])}}};i=function(t){for(var e,i,n,r,o=0,h=[],d=new a(t.buffer,t.byteOffset,t.byteLength);o<t.byteLength;)e=d.getUint32(o),i=s(t.subarray(o+4,o+8)),n=e>1?o+e:t.byteLength,r=(p[i]||function(t){return{data:t}})(t.subarray(o+8,n)),r.size=e,r.type=i,h.push(r),o=n;return h},n=function(t,e){var i;return e=e||0,i=Array(2*e+1).join(" "),t.map(function(t,a){return i+t.type+"\n"+Object.keys(t).filter(function(t){return"type"!==t&&"boxes"!==t}).map(function(e){var n=i+"  "+e+": ",a=t[e];if(a instanceof Uint8Array||a instanceof Uint32Array){var s=Array.prototype.slice.call(new Uint8Array(a.buffer,a.byteOffset,a.byteLength)).map(function(t){return" "+("00"+t.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return s?1===s.length?n+"<"+s.join("").slice(1)+">":n+"<\n"+s.map(function(t){return i+"  "+t}).join("\n")+"\n"+i+"  >":n+"<>"}return n+JSON.stringify(a,null,2).split("\n").map(function(t,e){return 0===e?t:i+"  "+t}).join("\n")}).join("\n")+(t.boxes?"\n"+n(t.boxes,e+1):"")}).join("\n")},t.muxjs=e||{},e.tools=e.tools||{},e.tools.inspectMp4=i,e.tools.textifyMp4=n}(this,this.muxjs);